<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>I Love You</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: #000;
  overflow: hidden;
}

/* Canvas tim */
canvas {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

/* Text layer */
#overlay {
  position: fixed;
  inset: 0;
  z-index: 2;
  pointer-events: none;
}

/* Typing text */
#love-text {
  position: absolute;
  bottom: 22%;
  width: 100%;
  text-align: center;
  font-size: clamp(26px, 7vw, 42px);
  color: #fff;
  letter-spacing: 0.25em;
  text-shadow:
    0 0 10px #ff7eb3,
    0 0 20px #ff4f9a;
  font-family: "Segoe Script", "Brush Script MT", cursive;
}

/* Signature */
#signature {
  position: absolute;
  bottom: 12%;
  width: 100%;
  text-align: center;
  font-size: clamp(14px, 4vw, 18px);
  color: #ffb6e6;
  opacity: 0.85;
}
</style>
</head>

<body>

<canvas id="pinkboard"></canvas>

<div id="overlay">
  <div id="love-text"></div>
  <div id="signature">From Tuáº¥n with love ðŸ’—</div>
</div>

<script>
/* ================= TYPING EFFECT ================= */
const message = "I LOVE YOU HOANG YEN";
const el = document.getElementById("love-text");
let i = 0;
let forward = true;

setInterval(() => {
  if (forward) {
    el.textContent = message.slice(0, i++);
    if (i > message.length) {
      forward = false;
      setTimeout(() => {}, 800);
    }
  } else {
    i--;
    el.textContent = message.slice(0, i);
    if (i <= 0) forward = true;
  }
}, 120);

/* ================= HEART PARTICLE (Gá»C Cá»¦A Báº N) ================= */

var settings = {
  particles: {
    length: 500,
    duration: 2,
    velocity: 100,
    effect: -0.75,
    size: 30,
  },
};

(function(){
  var b=0;
  var c=["ms","moz","webkit","o"];
  for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){
    window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];
    window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]
      ||window[c[a]+"CancelRequestAnimationFrame"]
  }
  if(!window.requestAnimationFrame){
    window.requestAnimationFrame=function(h){
      var d=new Date().getTime();
      var f=Math.max(0,16-(d-b));
      var g=window.setTimeout(function(){h(d+f)},f);
      b=d+f;
      return g
    }
  }
})();

function Point(x, y) {
  this.x = x || 0;
  this.y = y || 0;
}
Point.prototype.clone = function() {
  return new Point(this.x, this.y);
};
Point.prototype.length = function(l) {
  if (!l) return Math.sqrt(this.x*this.x + this.y*this.y);
  this.normalize();
  this.x *= l; this.y *= l;
  return this;
};
Point.prototype.normalize = function() {
  var l = this.length();
  this.x /= l; this.y /= l;
  return this;
};

function Particle() {
  this.position = new Point();
  this.velocity = new Point();
  this.acceleration = new Point();
  this.age = 0;
}
Particle.prototype.initialize = function(x,y,dx,dy) {
  this.position.x = x;
  this.position.y = y;
  this.velocity.x = dx;
  this.velocity.y = dy;
  this.acceleration.x = dx * settings.particles.effect;
  this.acceleration.y = dy * settings.particles.effect;
  this.age = 0;
};
Particle.prototype.update = function(dt) {
  this.position.x += this.velocity.x * dt;
  this.position.y += this.velocity.y * dt;
  this.velocity.x += this.acceleration.x * dt;
  this.velocity.y += this.acceleration.y * dt;
  this.age += dt;
};
Particle.prototype.draw = function(ctx, img) {
  function ease(t){ return (--t)*t*t+1 }
  var size = img.width * ease(this.age/settings.particles.duration);
  ctx.globalAlpha = 1 - this.age/settings.particles.duration;
  ctx.drawImage(img,
    this.position.x - size/2,
    this.position.y - size/2,
    size, size);
};

function ParticlePool(length) {
  this.particles = new Array(length);
  for (let i=0;i<length;i++) this.particles[i] = new Particle();
  this.firstActive = 0;
  this.firstFree = 0;
}
ParticlePool.prototype.add = function(x,y,dx,dy){
  this.particles[this.firstFree].initialize(x,y,dx,dy);
  this.firstFree = (this.firstFree+1)%this.particles.length;
  if (this.firstActive === this.firstFree)
    this.firstActive = (this.firstActive+1)%this.particles.length;
};
ParticlePool.prototype.update = function(dt){
  let i=this.firstActive;
  while (i!==this.firstFree){
    this.particles[i].update(dt);
    if (this.particles[i].age >= settings.particles.duration)
      this.firstActive = (this.firstActive+1)%this.particles.length;
    i=(i+1)%this.particles.length;
  }
};
ParticlePool.prototype.draw = function(ctx,img){
  let i=this.firstActive;
  while (i!==this.firstFree){
    this.particles[i].draw(ctx,img);
    i=(i+1)%this.particles.length;
  }
};

(function(canvas){
  const ctx = canvas.getContext("2d");
  const pool = new ParticlePool(settings.particles.length);
  const rate = settings.particles.length/settings.particles.duration;
  let time;

  function pointOnHeart(t){
    return new Point(
      160*Math.pow(Math.sin(t),3),
      130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
    );
  }

  const image = (() => {
    const c=document.createElement("canvas");
    const x=c.getContext("2d");
    c.width=c.height=settings.particles.size;
    x.fillStyle="#ea80b0";
    x.beginPath();
    let t=-Math.PI;
    let p=pointOnHeart(t);
    x.moveTo(c.width/2+p.x/350*c.width, c.height/2-p.y/350*c.height);
    while(t<Math.PI){
      t+=0.01;
      p=pointOnHeart(t);
      x.lineTo(c.width/2+p.x/350*c.width, c.height/2-p.y/350*c.height);
    }
    x.closePath(); x.fill();
    const img=new Image();
    img.src=c.toDataURL();
    return img;
  })();

  function resize(){
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
  }
  window.addEventListener("resize", resize);

  function render(){
    requestAnimationFrame(render);
    const now=Date.now()/1000;
    const dt=now-(time||now); time=now;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const count=rate*dt;
    for(let i=0;i<count;i++){
      const pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());
      const dir=pos.clone().length(settings.particles.velocity);
      pool.add(canvas.width/2+pos.x, canvas.height/2-pos.y, dir.x, -dir.y);
    }
    pool.update(dt);
    pool.draw(ctx,image);
  }

  resize();
  render();
})(document.getElementById("pinkboard"));
</script>

</body>
</html>
